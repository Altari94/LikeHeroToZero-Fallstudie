<!--
    review.html

    Review-Dashboard für Herausgeber (HERAUSGEBER).
    Best Practices: Übersichtliches Layout, Barrierefreiheit, konsistente UI, DataTable für Emissionsdaten, AJAX für Freigabe/Löschung.
    Wichtige Bereiche:
    - Header: Begrüßung und Logout
    - Tabelle: Übersicht aller ausstehenden Emissionsdatensätze
    - Aktionen: Freigeben und Löschen per AJAX
    - DataTable: Sortierung, Responsive
-->
<!DOCTYPE html>
<html lang="de" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Scientist Dashboard - LikeHeroToZero</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="/css/styles.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.7/css/jquery.dataTables.min.css">
</head>
<body>
<header class="header-bg">
    <div class="header-inner d-flex justify-content-between align-items-center">
        <div>
            <!-- Begrüßung mit Username -->
            <h1 class="main-title">Willkommen, <span th:text="${username}">Dr. Mustermann</span>.</h1>
            <div class="subtitle">CO₂-Daten prüfen und freigeben</div>
        </div>
        <!-- Logout-Button -->
        <form th:action="@{/logout}" method="post" class="logout-form">
            <button type="submit" class="btn btn-outline-danger fw-bold px-3 py-1">Logout</button>
        </form>
    </div>
</header>
<main>
    <div class="main-container">
        <section class="content-card">
            <div class="welcome-section">
                <div class="mission-text mb-3">
                    Neue CO₂-Daten warten auf Ihre Prüfung – freigeben oder ablehnen.
                </div>
            </div>
            <hr class="divider">
            <section class="table-section">
                <div class="datatable-search-wrapper"></div>
                <div class="table-scroll">
                    <!-- Tabelle mit allen ausstehenden Emissionsdatensätzen -->
                    <table id="co2Table" class="table custom-table align-middle mb-0 display nowrap" style="width:100%">
                        <thead>
                        <tr>
                            <th>Land</th>
                            <th>Jahr</th>
                            <th>Emissionen (kt)</th>
                            <th>Aktionen</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr th:each="data : ${emissions}">
                            <td th:text="${data.country.name}"></td>
                            <td th:text="${data.emissionYear}"></td>
                            <td th:text="${data.co2Kt}"></td>
                            <td>
                                <div class="action-btns">
                                    <!-- Button zum Freigeben des Datensatzes -->
                                    <button class="btn btn-success btn-sm approve-btn" th:attr="data-id=${data.id}">Freigeben</button>
                                    <!-- Button zum Löschen des Datensatzes -->
                                    <button class="btn btn-danger btn-sm delete-btn" th:attr="data-id=${data.id}">Löschen</button>
                                </div>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </section>
        </section>
    </div>
</main>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script src="https://cdn.datatables.net/1.13.7/js/jquery.dataTables.min.js"></script>
<script>
    // Initialisiert DataTable für die Emissionsübersicht
    $('#co2Table').DataTable({
        paging: false,
        info: false,
        ordering: true,
        order: [],
        searching: false,
        language: {
            url: "https://cdn.datatables.net/plug-ins/1.13.7/i18n/de-DE.json"
        },
        scrollX: true,
        dom: '<"datatable-search-wrapper d-flex justify-content-center mb-3"f>t'
    });

    // Freigeben-Button: Setzt Status per AJAX auf APPROVED und entfernt die Zeile
    $('#co2Table').on('click', '.approve-btn', function() {
        const row = $(this).closest('tr');
        const id = $(this).data('id');
        $.ajax({
            url: `/api/co2-data/${id}/approve`,
            type: 'PATCH',
            success: function() {
                row.fadeOut(300, function() { $(this).remove(); });
            }
        });
    });

    // Löschen-Button: Löscht den Datensatz per AJAX und entfernt die Zeile
    $('#co2Table').on('click', '.delete-btn', function() {
        const row = $(this).closest('tr');
        const id = $(this).data('id');
        $.ajax({
            url: `/api/co2-data/${id}`,
            type: 'DELETE',
            success: function() {
                row.fadeOut(300, function() { $(this).remove(); });
            }
        });
    });
</script>
</body>
</html>