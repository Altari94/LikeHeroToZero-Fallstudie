-- V3__security_users_roles.sql

-- Erstellt die Tabelle für Rollen (z.B. Scientist, Herausgeber)
CREATE TABLE role (
    id   BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    name VARCHAR(50) NOT NULL UNIQUE
);

-- Erstellt die Tabelle für Benutzer mit Rollenbezug
CREATE TABLE app_user (
    id            BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    username      VARCHAR(100) NOT NULL UNIQUE,
    password_hash VARCHAR(200) NOT NULL,
    enabled       BOOLEAN      NOT NULL DEFAULT TRUE,
    role_id       BIGINT NOT NULL,
    CONSTRAINT fk_role FOREIGN KEY (role_id) REFERENCES role(id)
);

-- Legt die Standardrollen an
INSERT INTO role(name) VALUES ('SCIENTIST');
INSERT INTO role(name) VALUES ('HERAUSGEBER');

-- Legt Beispielnutzer mit Passwort 'secret' an
INSERT INTO app_user(username, password_hash, enabled, role_id)
SELECT 'Scientist', '$2a$10$M0M26VXO3OLtDcx0Nte/LO.hgulTidnUeyiDJhQjDPiYWzEi/wiHW', TRUE, r.id FROM role r WHERE r.name='SCIENTIST';

INSERT INTO app_user(username, password_hash, enabled, role_id)
SELECT 'Herausgeber', '$2a$10$M0M26VXO3OLtDcx0Nte/LO.hgulTidnUeyiDJhQjDPiYWzEi/wiHW', TRUE, r.id FROM role r WHERE r.name='HERAUSGEBER';